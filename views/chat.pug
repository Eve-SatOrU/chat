meta(charset="UTF-8")
meta(name="viewport", content="width=device-width,initial-scale=1")
title chat
link(rel="stylesheet", href="/css/index.css")
link(rel="preconnect", href="https://fonts.googleapis.com")
link(rel="preconnect", href="https://fonts.gstatic.com", crossorigin)
link(href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap", rel="stylesheet")
link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css")
.container
  .navbar
    .logo
      img(src="/images/logo2.png", width="123px")
    nav
      ul#MenuItems
        li.main-header__item
          a(href="/", class=(path === '/' ? 'active' : '')) Home
        li.main-header__item
          a(href="/about", class=(path === '/about' ? 'active' : '')) About
        if user
          li.main-header__item
            a( href=`/profile/${user.id}`,class=(path === '/profile' ? 'active' : '')) Profile
          li.main-header__item
            a(href=`/chat/${user.id}`) chat
          li.main-header__item
            a(href="/logout", class=(path === '/logout' ? 'active' : '')) Logout

        else
          li.main-header__item
            a(href="/register", class=(path === '/register' ? 'active' : '')) Register
          li.main-header__item
            a(href="/login", class=(path === '/login' ? 'active' : '')) Login

    a(href="/donate")
      img(src="/images/cart.png", width="30px", height="30px")
// ----------------account-pabe-------------
.account-page
  .container
    .row
      .col-3
        h2 Chat with #{user.userName}
        img(src="/images/about1.svg", width="100%")
        #messages 
        div.box#messages
        form#file-form(action="/send-file", method="POST", enctype="multipart/form-data")
          input#message-input(type="text")
          input#file-input(type="file", name="file")
          button.btn#send-button(type="submit") send

script(src="/socket.io/socket.io.js")
script.
  const socket = io();

  // send chat messages
  const messageInput = document.querySelector('#message-input');
  const sendButton = document.querySelector('#send-button');
  sendButton.addEventListener('click', (event) => {
    const message = messageInput.value.trim();
    socket.emit('message', message);
    messageInput.value = '';
  });

  // handle file upload
  const fileForm = document.getElementById('file-form');
  fileForm.addEventListener('submit', (event) => {
    event.preventDefault();
    const message = messageInput.value.trim();
    const fileInput = document.getElementById('file-input');
    const file = fileInput.files[0];
    if (file) {
      const formData = new FormData();
      formData.append('file', file);
      fetch(fileForm.action, {
        method: 'POST',
        body: formData,
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(response.statusText);
        }
        return response.json();
      })
      .then(data => {
        socket.emit('file', { message, fileUrl: data.filename });
        console.log(data);
      })
      .catch(error => console.log(error));
    } else if (message) {
      socket.emit('message', message);
    }
    messageInput.value = '';
    fileInput.value = '';
  });

  // listen for incoming chat messages
  socket.on('message', (data) => {
    const messageElem = document.createElement('li');
    messageElem.textContent = data;
    //- messageElem.classList.add('chat-message'); // add a class to the message element
 

    const messagesElem = document.querySelector('#messages');
    messagesElem.appendChild(messageElem);
    
  });
  // listen for incoming file uploads
  socket.on('file', (data) => {
    const messageElem = document.createElement('li');
    messageElem.textContent = data.message;

    const fileElem = document.createElement('a');
    fileElem.textContent = data.fileUrl;
    fileElem.href = '/uploads/' + data.fileUrl;
    fileElem.download = data.fileUrl;

    messageElem.appendChild(fileElem);

    //- const messagesElem = document.querySelector('#messages');
    //- messagesElem.appendChild(messageElem);
  });

// ----------------footer----------
.footer
  .container
    .row
      .footer-col-1
        h3 Download Our App
        p Download App for Android and ios mobile phone.
        .app-logo
          img(src="/images/play-store.png")
          img(src="/images/app-store.png")
      .footer-col-2
        p Our purpose is to sustainbly make the pleasure and benefits of style and accessories to the many.
      .footer-col-3
        h3 Useful Links
        ul
          li Coupons
          li Blog Post
          li Return Policy
          li Join Affiliate
      .footer-col-4
        h3 Follow Us
        ul
          li Facebook
          li Twitter
          li Instagram
          li Youtube
    hr
    p.copyright copyright 2020
    